var GridProtocol=function(t){"use strict";var e=4294967296,i=1/e,r="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8"),o=function(t){void 0===t&&(t=new Uint8Array(16)),this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length};function n(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function s(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var o=i.pos-1;o>=t;o--)i.buf[o+r]=i.buf[o]}function a(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function h(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function p(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function u(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function d(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function f(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function l(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function c(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function w(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function v(t,e){t.string_value&&e.writeStringField(1,t.string_value),t.float_value&&e.writeFloatField(2,t.float_value),t.double_value&&e.writeDoubleField(3,t.double_value),t.int_value&&e.writeVarintField(4,t.int_value),t.uint_value&&e.writeVarintField(5,t.uint_value),t.sint_value&&e.writeSVarintField(6,t.sint_value),t.bool_value&&e.writeBooleanField(7,t.bool_value)}function g(t,e){t.id&&e.writeVarintField(1,t.id),t.tags&&e.writePackedVarint(2,t.tags),t.type&&e.writeVarintField(3,t.type),t.geometry&&e.writePackedVarint(4,t.geometry)}function y(t,e){if(t.version&&e.writeVarintField(15,t.version),t.name&&e.writeStringField(1,t.name),t.features)for(var i of t.features)e.writeMessage(2,g,i);if(t.keys)for(var r of t.keys)e.writeStringField(3,r);if(t.values)for(var o of t.values)e.writeMessage(4,v,o);t.extent&&e.writeVarintField(5,t.extent)}o.prototype.readFields=function(t,e,i){for(void 0===i&&(i=this.length);this.pos<i;){var r=this.readVarint(),o=r>>3,n=this.pos;this.type=7&r,t(o,e,this),this.pos===n&&this.skip(r)}return e},o.prototype.readMessage=function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},o.prototype.readFixed32=function(){var t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t},o.prototype.readSFixed32=function(){var t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t},o.prototype.readFixed64=function(){var t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*e;return this.pos+=8,t},o.prototype.readSFixed64=function(){var t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*e;return this.pos+=8,t},o.prototype.readFloat=function(){var t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t},o.prototype.readDouble=function(){var t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t},o.prototype.readVarint=function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(t,e,i){var r,o,s=i.buf;if(o=s[i.pos++],r=(112&o)>>4,o<128)return n(t,r,e);if(o=s[i.pos++],r|=(127&o)<<3,o<128)return n(t,r,e);if(o=s[i.pos++],r|=(127&o)<<10,o<128)return n(t,r,e);if(o=s[i.pos++],r|=(127&o)<<17,o<128)return n(t,r,e);if(o=s[i.pos++],r|=(127&o)<<24,o<128)return n(t,r,e);if(o=s[i.pos++],r|=(1&o)<<31,o<128)return n(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},o.prototype.readVarint64=function(){return this.readVarint(!0)},o.prototype.readSVarint=function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},o.prototype.readBoolean=function(){return Boolean(this.readVarint())},o.prototype.readString=function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&r?r.decode(this.buf.subarray(e,t)):function(t,e,i){var r="",o=e;for(;o<i;){var n=t[o],s=null,a=n>239?4:n>223?3:n>191?2:1;if(o+a>i)break;var h=void 0,p=void 0,u=void 0;1===a?n<128&&(s=n):2===a?128==(192&(h=t[o+1]))&&(s=(31&n)<<6|63&h)<=127&&(s=null):3===a?(h=t[o+1],p=t[o+2],128==(192&h)&&128==(192&p)&&((s=(15&n)<<12|(63&h)<<6|63&p)<=2047||s>=55296&&s<=57343)&&(s=null)):4===a&&(h=t[o+1],p=t[o+2],u=t[o+3],128==(192&h)&&128==(192&p)&&128==(192&u)&&((s=(15&n)<<18|(63&h)<<12|(63&p)<<6|63&u)<=65535||s>=1114112)&&(s=null)),null===s?(s=65533,a=1):s>65535&&(s-=65536,r+=String.fromCharCode(s>>>10&1023|55296),s=56320|1023&s),r+=String.fromCharCode(s),o+=a}return r}(this.buf,e,t)},o.prototype.readBytes=function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},o.prototype.readPackedVarint=function(t,e){void 0===t&&(t=[]);for(var i=this.readPackedEnd();this.pos<i;)t.push(this.readVarint(e));return t},o.prototype.readPackedSVarint=function(t){void 0===t&&(t=[]);for(var e=this.readPackedEnd();this.pos<e;)t.push(this.readSVarint());return t},o.prototype.readPackedBoolean=function(t){void 0===t&&(t=[]);for(var e=this.readPackedEnd();this.pos<e;)t.push(this.readBoolean());return t},o.prototype.readPackedFloat=function(t){void 0===t&&(t=[]);for(var e=this.readPackedEnd();this.pos<e;)t.push(this.readFloat());return t},o.prototype.readPackedDouble=function(t){void 0===t&&(t=[]);for(var e=this.readPackedEnd();this.pos<e;)t.push(this.readDouble());return t},o.prototype.readPackedFixed32=function(t){void 0===t&&(t=[]);for(var e=this.readPackedEnd();this.pos<e;)t.push(this.readFixed32());return t},o.prototype.readPackedSFixed32=function(t){void 0===t&&(t=[]);for(var e=this.readPackedEnd();this.pos<e;)t.push(this.readSFixed32());return t},o.prototype.readPackedFixed64=function(t){void 0===t&&(t=[]);for(var e=this.readPackedEnd();this.pos<e;)t.push(this.readFixed64());return t},o.prototype.readPackedSFixed64=function(t){void 0===t&&(t=[]);for(var e=this.readPackedEnd();this.pos<e;)t.push(this.readSFixed64());return t},o.prototype.readPackedEnd=function(){return 2===this.type?this.readVarint()+this.pos:this.pos+1},o.prototype.skip=function(t){var e=7&t;if(0===e)for(;this.buf[this.pos++]>127;);else if(2===e)this.pos=this.readVarint()+this.pos;else if(5===e)this.pos+=4;else{if(1!==e)throw new Error("Unimplemented type: "+e);this.pos+=8}},o.prototype.writeTag=function(t,e){this.writeVarint(t<<3|e)},o.prototype.realloc=function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=e}},o.prototype.finish=function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},o.prototype.writeFixed32=function(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4},o.prototype.writeSFixed32=function(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4},o.prototype.writeFixed64=function(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*i),!0),this.pos+=8},o.prototype.writeSFixed64=function(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*i),!0),this.pos+=8},o.prototype.writeVarint=function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,r;t>=0?(i=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,r=r+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos]=127&t}(i,0,e),function(t,e){var i=(7&t)<<4;if(e.buf[e.pos++]|=i|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},o.prototype.writeSVarint=function(t){this.writeVarint(t<0?2*-t-1:2*t)},o.prototype.writeBoolean=function(t){this.writeVarint(+t)},o.prototype.writeString=function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var r=0,o=void 0,n=void 0;r<e.length;r++){if((o=e.charCodeAt(r))>55295&&o<57344){if(!n){o>56319||r+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):n=o;continue}if(o<56320){t[i++]=239,t[i++]=191,t[i++]=189,n=o;continue}o=n-55296<<10|o-56320|65536,n=null}else n&&(t[i++]=239,t[i++]=191,t[i++]=189,n=null);o<128?t[i++]=o:(o<2048?t[i++]=o>>6|192:(o<65536?t[i++]=o>>12|224:(t[i++]=o>>18|240,t[i++]=o>>12&63|128),t[i++]=o>>6&63|128),t[i++]=63&o|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&s(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},o.prototype.writeFloat=function(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4},o.prototype.writeDouble=function(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8},o.prototype.writeBytes=function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},o.prototype.writeRawMessage=function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&s(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},o.prototype.writeMessage=function(t,e,i){this.writeTag(t,2),this.writeRawMessage(e,i)},o.prototype.writePackedVarint=function(t,e){e.length&&this.writeMessage(t,a,e)},o.prototype.writePackedSVarint=function(t,e){e.length&&this.writeMessage(t,h,e)},o.prototype.writePackedBoolean=function(t,e){e.length&&this.writeMessage(t,d,e)},o.prototype.writePackedFloat=function(t,e){e.length&&this.writeMessage(t,p,e)},o.prototype.writePackedDouble=function(t,e){e.length&&this.writeMessage(t,u,e)},o.prototype.writePackedFixed32=function(t,e){e.length&&this.writeMessage(t,f,e)},o.prototype.writePackedSFixed32=function(t,e){e.length&&this.writeMessage(t,l,e)},o.prototype.writePackedFixed64=function(t,e){e.length&&this.writeMessage(t,c,e)},o.prototype.writePackedSFixed64=function(t,e){e.length&&this.writeMessage(t,w,e)},o.prototype.writeBytesField=function(t,e){this.writeTag(t,2),this.writeBytes(e)},o.prototype.writeFixed32Field=function(t,e){this.writeTag(t,5),this.writeFixed32(e)},o.prototype.writeSFixed32Field=function(t,e){this.writeTag(t,5),this.writeSFixed32(e)},o.prototype.writeFixed64Field=function(t,e){this.writeTag(t,1),this.writeFixed64(e)},o.prototype.writeSFixed64Field=function(t,e){this.writeTag(t,1),this.writeSFixed64(e)},o.prototype.writeVarintField=function(t,e){this.writeTag(t,0),this.writeVarint(e)},o.prototype.writeSVarintField=function(t,e){this.writeTag(t,0),this.writeSVarint(e)},o.prototype.writeStringField=function(t,e){this.writeTag(t,2),this.writeString(e)},o.prototype.writeFloatField=function(t,e){this.writeTag(t,5),this.writeFloat(e)},o.prototype.writeDoubleField=function(t,e){this.writeTag(t,1),this.writeDouble(e)},o.prototype.writeBooleanField=function(t,e){this.writeVarintField(t,+e)};var F=maplibregl.MercatorCoordinate,b=maplibregl.LngLatBounds;function V(t){var e=Math.abs(t);return{d:Math.floor(e/3600),m:Math.floor(e/60)%60,s:t%60}}function x(t){var e=V(t);return(t<0?1e7:2e7)+1e4*e.d+100*e.m+e.s}function S(t){var e=V(t);return(t<0?3e7:4e7)+1e4*e.d+100*e.m+e.s}function k(t,e){var i=function(t){return t<<1^t>>31},r=Array.from(new Set(t.map((function(t){return t.label})))),n={layers:[{version:2,name:"line",features:t.map((function(t){var e=t.coords,o=t.id,n=t.label;return{id:o,tags:[0,r.indexOf(n)],type:2,geometry:[9,i(e[0]),i(e[1]),10,i(e[2]-e[0]),i(e[3]-e[1]),15]}})),keys:["label"],values:r.map((function(t){return{string_value:t}})),extent:e}]},s=new o;return function(t,e){if(t.layers)for(var i of t.layers)e.writeMessage(3,y,i)}(n,s),s.finish()}return t.createLoadFn=function(t){var e={extent:4096,lon2label:function(t){var e=V(t),i=e.d,r=e.m,o=e.s;return(t<0?"w":"E")+" "+i.toString().padStart(3,0)+" "+r.toString().padStart(2,0)+" "+o.toString().padStart(2,0)},lat2label:function(t){var e=V(t),i=e.d,r=e.m,o=e.s;return(t<0?"S":"N")+" "+i.toString().padStart(2,0)+" "+r.toString().padStart(2,0)+" "+o.toString().padStart(2,0)},interval:function(t){return t.z<5?3600:t.z<10?60:1}};t&&Object.assign(e,t);var i=e.extent,r=e.lat2label,o=e.lon2label,n=e.interval;return function(t,e){for(var s,a=function(t){var e=t.replace(/\.pbf$/,"").split("/"),i=parseInt(e.pop()),r=parseInt(e.pop()),o=parseInt(e.pop()),n=Math.pow(2,o),s=new F(r/n,i/n),a=new F((r+1)/n,(i+1)/n),h=new F(r/n,(i+1)/n).toLngLat(),p=new F((r+1)/n,i/n).toLngLat();return{tile:{z:o,x:r,y:i},bounds:new b(h,p),mercator:{ox:s.x,oy:s.y,w:a.x-s.x,h:a.y-s.y}}}(t.url),h=a.tile,p=a.bounds,u=a.mercator,d=(s=n(h),Array.isArray(s)?s:[s,s]),f=d[0],l=d[1],c=[],w=Math.floor(3600*p.getWest()/f)*f,v=Math.floor(3600*p.getEast()/f)*f,g=w;g<=v;g+=f){var y=F.fromLngLat([g/3600,0]).x,V=Math.floor(i*(y-u.ox)/u.w);0<=V&&V<=i&&c.push({coords:[V,0,V,i],id:x(g),label:o(g)})}for(var M=Math.floor(3600*p.getSouth()/l)*l,P=Math.floor(3600*p.getNorth()/l)*l,m=M;m<=P;m+=l){var E=F.fromLngLat([0,m/3600,0]).y,B=Math.floor(i*(E-u.oy)/u.h);0<=B&&B<=i&&c.push({coords:[0,B,i,B],id:S(m),label:r(m)})}var _=k(c,i),T=maplibregl.version||maplibregl.getVersion();if(!(parseInt(T.split(".")[0])<=3))return Promise.resolve({data:_});e(null,_,null,null)}},t}({});
